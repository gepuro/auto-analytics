# Auto Analytics Report Display Server

Independent FastAPI server for displaying HTML reports generated by the Auto Analytics AI agent system.

## Overview

This is a completely decoupled web server that only handles report display functionality. It does not generate reports - that's handled by the separate AI agent system.

## Architecture

- **Purpose**: Display HTML reports created by AI agent
- **Communication**: File-based through shared `reports/` directory
- **Independence**: Can start/stop independently of AI agent
- **Port**: Default 9000 (different from AI agent on 8000)

## Quick Start

### Install Dependencies

```bash
cd fastapi-server
pip install -r requirements.txt
```

### Run Server

```bash
# Basic usage
python main.py

# Custom configuration
python main.py --host 0.0.0.0 --port 9000 --reports-dir ../reports

# Development mode with auto-reload
python main.py --reload
```

### Alternative: Using uvicorn directly

```bash
uvicorn main:app --host localhost --port 9000 --reload
```

## API Endpoints

### Web Interface
- `GET /` - Main reports listing page
- `GET /reports/{filename}` - Display specific HTML report in browser
- `GET /reports/{filename}/download` - Download HTML report as file

### REST API
- `GET /api/reports` - List all reports (JSON)
- `GET /api/reports/{filename}/info` - Get report metadata
- `DELETE /api/reports/{filename}` - Delete a report
- `POST /api/refresh` - Refresh reports list
- `GET /api/health` - Health check
- `GET /api/docs` - API documentation (Swagger UI)

## Configuration

### Environment Variables
- `REPORTS_DIR` - Directory to monitor for reports (default: ../reports)
- `HOST` - Server host (default: localhost)
- `PORT` - Server port (default: 9000)

### Command Line Options
- `--host` - Host to bind to
- `--port` - Port to bind to
- `--reports-dir` - Directory containing reports
- `--reload` - Enable auto-reload for development

## File Structure

```
fastapi-server/
├── main.py              # Main FastAPI application
├── requirements.txt     # Python dependencies
├── README.md           # This file
├── templates/          # Jinja2 templates
│   ├── report_list.html
│   └── styles.css
└── static/            # Static files (CSS, JS, images)
```

## Security Features

- Filename validation to prevent directory traversal
- CORS middleware for cross-origin requests
- Only serves .html files from reports directory
- Input sanitization for all endpoints

## Monitoring

The server provides several endpoints for monitoring:
- Health check endpoint at `/api/health`
- Reports count and status information
- File system monitoring for new reports

## Development

### Adding New Features
1. Add new routes in `main.py`
2. Update templates in `templates/` directory
3. Add static assets in `static/` directory

### Testing
```bash
# Run the server
python main.py --reload

# Test endpoints
curl http://localhost:9000/api/health
curl http://localhost:9000/api/reports
```

## Integration with AI Agent

The FastAPI server integrates with the AI agent through file-based communication:

1. AI agent generates HTML reports → `reports/` directory
2. FastAPI server monitors `reports/` directory → displays reports
3. No direct coupling between services
4. Each service can restart independently

## Troubleshooting

### Common Issues

**Reports not showing up:**
- Check that reports directory exists and is readable
- Verify file permissions
- Ensure reports are .html files

**Server won't start:**
- Check if port is already in use
- Verify dependencies are installed
- Check file permissions

**CORS issues:**
- CORS is enabled for all origins by default
- Modify CORS settings in `main.py` if needed

### Logs
Check uvicorn logs for detailed error information:
```bash
python main.py --log-level debug
```